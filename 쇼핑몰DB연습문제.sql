CREATE TABLE CATEGORIES(
		CATEGORY_ID NUMBER PRIMARY KEY,
		CATEGORY_NAME VARCHAR2(100) UNIQUE
);

CREATE TABLE PRODUCTS(
		PRODUCT_ID NUMBER PRIMARY KEY,
		PRODUCT_NAME VARCHAR2(100) NOT NULL,
		CATEGORY NUMBER REFERENCES CATEGORIES(CATEGORY_ID),
		PRICE NUMBER DEFAULT 0,
		STOCK_QUANTITY NUMBER DEFAULT 0
);

CREATE TABLE CUSTOMERS(
		CUSTOMER_ID NUMBER PRIMARY KEY,
		NAME VARCHAR2(20) NOT NULL,
		GENDER VARCHAR2(3) CHECK(GENDER IN ('남', '여')),
		ADDRESS VARCHAR2(100),
		PHONE VARCHAR(30)
);

CREATE TABLE ORDERS(
		ORDER_ID NUMBER PRIMARY KEY,
		CUSTOMER_ID NUMBER REFERENCES CUSTOMERS(CUSTOMER_ID) ON DELETE CASCADE,
		ORDER_DATE DATE DEFAULT SYSDATE,
		STATUS CHAR(1) CHECK (STATUS IN ('Y', 'N'))
		
);

CREATE TABLE ORDER_DETAILS(
		ORDER_DETAIL_ID NUMBER PRIMARY KEY,
		ORDER_ID NUMBER REFERENCES ORDERS(ORDER_ID),
		PRODUCT_ID NUMBER REFERENCES PRODUCTS(PRODUCT_ID) ON DELETE SET NULL,
		QUNTITY NUMBER,
		PRICE_PER_NUIT NUMBER
);

-- CATAGORIES 샘플 데이터
INSERT INTO CATEGORIES VALUES(1, '스마트폰');
INSERT INTO CATEGORIES VALUES(2, 'TV');
INSERT INTO CATEGORIES VALUES(3, 'Gaming');

SELECT * FROM CATEGORIES;


-- PRODUCTS 샘플 데이터
INSERT INTO PRODUCTS VALUES(101, 'Apple iPhone 12', 1, 1500000, 30);
INSERT INTO PRODUCTS VALUES(102, 'Samsung Galaxy S24', 1, 1800000, 50);
INSERT INTO PRODUCTS VALUES(201, 'LG OLED TV', 2, 3600000, 10);
INSERT INTO PRODUCTS VALUES(301, 'Sony PlayStation 5', 3, 700000, 15);

SELECT * FROM PRODUCTS;


-- CUSTOMERS 테이블 샘플 데이터
INSERT INTO CUSTOMERS VALUES(1, '홍길동', '남', '서울시 성동구 왕십리', '010-1111-2222');
INSERT INTO CUSTOMERS VALUES(2, '유관순', '여', '서울시 종로구 안국동', '010-3333-1111');

SELECT * FROM CUSTOMERS;


-- ORDERS 샘플 데이터
INSERT INTO ORDERS VALUES(576, 1, '2024-02-29', 'N');
INSERT INTO ORDERS VALUES(978, 2, '2024-03-11', 'Y');
INSERT INTO ORDERS VALUES(777, 2, '2024-03-11', 'N');
INSERT INTO ORDERS VALUES(134, 1, '2022-12-25', 'Y');
INSERT INTO ORDERS VALUES(499, 1, '2020-01-03', 'Y');

SELECT * FROM ORDERS;


-- ORDER_DETAILS 샘플 데이터
INSERT INTO ORDER_DETAILS VALUES(111, 576, 101, 1, 1500000);
INSERT INTO ORDER_DETAILS VALUES(222, 978, 201, 2, 3600000);
INSERT INTO ORDER_DETAILS VALUES(333, 978, 102, 1, 1800000);
INSERT INTO ORDER_DETAILS VALUES(444, 777, 301, 5, 700000);
INSERT INTO ORDER_DETAILS VALUES(555, 134, 102, 1, 1800000);
INSERT INTO ORDER_DETAILS VALUES(666, 499, 201, 3, 3600000);

SELECT * FROM ORDER_DETAILS;


------------------------------------------------------------

-- 1. 
SELECT NAME 고객명, ORDER_DATE 주문일, STATUS 처리상태
FROM ORDERS
JOIN CUSTOMERS USING(CUSTOMER_ID)
WHERE STATUS = 'N';


-- 2. 
SELECT ORDER_ID 주문번호, ORDER_DATE 주문날짜, STATUS 처리상태
FROM ORDERS 
JOIN CUSTOMERS USING(CUSTOMER_ID)
WHERE EXTRACT(YEAR FROM ORDER_DATE) = EXTRACT(YEAR FROM SYSDATE)
AND NAME = '홍길동';


-- 3. 
SELECT *
FROM ORDER_DETAILS;

SELECT ORDER_ID 주문번호, PRODUCT_NAME 상품명, QUNTITY 수량, 
				PRICE_PER_NUIT 개별금액, QUNTITY * PRICE_PER_NUIT 주문별금액합계
FROM ORDER_DETAILS
JOIN PRODUCTS USING(PRODUCT_ID)
JOIN ORDERS USING(ORDER_ID)
JOIN CUSTOMERS USING(CUSTOMER_ID)
WHERE NAME = '유관순'
ORDER BY ORDER_ID, PRODUCT_NAME;























